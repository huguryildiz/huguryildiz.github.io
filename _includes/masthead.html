{% include base_path %}
<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav" aria-label="Primary navigation">

        <!-- Site title (always visible) -->
        <a class="site-title" href="{{ base_path }}/">
          {{ site.title }}
        </a>

        <!-- Nav links (greedy-nav will move these into hidden-links on mobile) -->
        <ul class="visible-links">
          {% for link in site.data.navigation.main %}
            {% if link.url contains 'http' %}
              {% assign domain = '' %}
            {% else %}
              {% assign domain = base_path %}
            {% endif %}

            <li class="masthead__menu-item{% if page.url contains link.url and link.url != '/' %} selected{% endif %}">
              <a href="{{ domain }}{{ link.url }}">{{ link.title }}</a>
            </li>
          {% endfor %}
        </ul>

        <!-- Right controls (theme toggle + hamburger) -->
        <div class="masthead-controls" aria-label="Controls">
          <a id="theme-toggle" href="#" role="button" aria-label="Toggle theme">
            <i id="theme-icon" class="fas fa-sun" aria-hidden="true"></i>
          </a>

          <!-- Minimal Mistakes hamburger -->
          <button class="greedy-nav__toggle hidden" type="button" aria-label="Toggle menu">
            <span class="navicon"></span>
          </button>
        </div>

        <!-- Greedy-nav puts overflow links here -->
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<style>
/* =========================================================
   Fix alignment: keep theme + hamburger on same baseline
   ========================================================= */
.masthead-controls{
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

#theme-toggle{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 6px 10px;
  text-decoration: none !important;
  cursor: pointer;
}

#theme-toggle i{
  display: inline-block;
  width: 1.25em;
  line-height: 1;
  font-size: 1.15rem;
}

/* =========================================================
   Mobile behavior (NO custom menu):
   Force greedy-nav to overflow => ALL links go into hamburger
   ========================================================= */
@media (max-width: 768px){

  /* Make greedy-nav calculations treat visible-links as "no space" */
  .greedy-nav .visible-links{
    width: 0 !important;
    flex: 0 0 0 !important;
    overflow: hidden !important;
    white-space: nowrap;
  }

  /* Ensure hamburger is visible on mobile (even if theme adds hidden) */
  .greedy-nav__toggle,
  .greedy-nav__toggle.hidden{
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
}
</style>

<script>
/* =========================================================
   Theme toggle (sun/moon) - no dependency on mobile layout
   ========================================================= */
(function () {
  const KEY = "theme"; // "dark" | "light"

  function setIcon(theme) {
    const icon = document.getElementById("theme-icon");
    if (!icon) return;
    icon.classList.remove("fa-sun", "fa-moon");
    icon.classList.add(theme === "dark" ? "fa-moon" : "fa-sun");
  }

  function applyTheme(theme) {
    const root = document.documentElement;
    root.classList.toggle("dark", theme === "dark");
    root.setAttribute("data-theme", theme);
    setIcon(theme);
  }

  function getInitialTheme() {
    try {
      const saved = localStorage.getItem(KEY);
      if (saved === "dark" || saved === "light") return saved;
    } catch (e) {}

    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;

    return prefersDark ? "dark" : "light";
  }

  function toggleTheme() {
    const isDark = document.documentElement.classList.contains("dark");
    const next = isDark ? "light" : "dark";
    try { localStorage.setItem(KEY, next); } catch (e) {}
    applyTheme(next);
  }

  applyTheme(getInitialTheme());

  document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("theme-toggle");
    if (btn) {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        toggleTheme();
      });
    }

    const mq = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)");
    if (mq && mq.addEventListener) {
      mq.addEventListener("change", function (e) {
        let saved = null;
        try { saved = localStorage.getItem(KEY); } catch (err) {}
        if (!saved) applyTheme(e.matches ? "dark" : "light");
      });
    }
  });
})();
</script>